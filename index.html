<!DOCTYPE html>
<html lang="id"> <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- SEO Optimization -->
  <title>Dasbor Statistik Mining Monero (XMR)</title>
  <meta name="description" content="Lacak statistik mining Monero (XMR) Anda secara real-time: saldo terutang (pending), total terbayar, hashrate, shares (valid/invalid), dan total hash. Update otomatis.">
  <meta name="keywords" content="monero, xmr, mining, stats, dashboard, cryptocurrency, hashrate, supportxmr">
  <link rel="canonical" href="YOUR_CANONICAL_URL_HERE" /> <!-- Ganti dengan URL halaman Anda jika sudah di-deploy -->
  <!-- Favicon (opsional tapi direkomendasikan) -->
  <!-- <link rel="icon" href="/favicon.ico" sizes="any"> -->
  <!-- <link rel="icon" href="/favicon.svg" type="image/svg+xml"> -->
  <!-- <link rel="apple-touch-icon" href="/apple-touch-icon.png"> -->

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">

  <style>
    /* CSS Variables for easier theming */
    :root {
      --background-color: #ffffff;
      --text-color: #000000;
      --primary-accent-color: #333333; /* Used for prominent text like pending amount */
      --secondary-text-color: #666666;
      --border-color: #dddddd;
      --button-shadow-color: rgba(0, 0, 0, 0.1);
      --input-border-color: #cccccc;
      --body-font: 'DM Sans', sans-serif;
      --icon-font: 'Material Icons';
    }

    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      width: 100%;
      overflow-x: hidden; /* Prevent horizontal scroll */
    }
    body {
      font-family: var(--body-font);
      background-color: var(--background-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      position: relative;
      -webkit-font-smoothing: antialiased; /* Smoother fonts */
      -moz-osx-font-smoothing: grayscale;
    }

    /* Visually Hidden Class for SEO/Accessibility */
    .visually-hidden {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap; /* prevent line breaks */
    }

    /* Layout Container */
    .container {
      text-align: center;
      width: 100%;
      max-width: 360px; /* Base mobile width */
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      justify-content: center;
      padding-bottom: 3rem; /* Space for the fake hash */
    }
    /* Responsive adjustments */
    @media (min-width: 600px) {
      .container { max-width: 550px; }
    }
    @media (min-width: 900px) {
      .container { max-width: 750px; }
    }
    @media (min-width: 1200px) {
      .container { max-width: 850px; }
    }

    /* Wallet Input Section */
    .wallet-section {
      width: 100%;
      max-width: 500px; /* Limit width of the input area */
      position: sticky;
      top: 1rem;
      z-index: 10;
      background-color: var(--background-color); /* Ensure background hides content below */
      padding-bottom: 0.5rem; /* Space below toggle */
      margin-bottom: 1rem;
    }
    .wallet-toggle {
      background-color: var(--background-color);
      border: 1px solid var(--border-color);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px var(--button-shadow-color);
      margin: 0 auto 0.5rem auto; /* Center toggle */
      transition: transform 0.3s ease;
    }
    .wallet-toggle:hover {
        transform: scale(1.1);
    }
    .wallet-toggle .material-icons {
      font-family: var(--icon-font);
      font-size: 24px;
      transition: transform 0.3s ease;
      line-height: 1; /* Ensure icon is vertically centered */
    }
    .wallet-toggle.open .material-icons {
      transform: rotate(180deg);
    }

    /* Wallet Form */
    form#walletForm {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 0.4s ease-out, opacity 0.3s ease-out, padding 0.4s ease-out;
      padding-top: 0;
      padding-bottom: 0;
    }
    form#walletForm.visible {
      max-height: 80px; /* Increased slightly for padding */
      opacity: 1;
      padding-top: 0.5rem;
      padding-bottom: 1rem;
    }
    input[type="text"]#walletInput {
      flex: 1;
      min-width: 0; /* Prevent input from overflowing flex container */
      padding: 0.75rem 1rem;
      border: 1px solid var(--input-border-color);
      border-radius: 2rem;
      font-size: clamp(0.85rem, 2.5vw, 1rem); /* Responsive font size */
      font-family: var(--body-font);
      background-color: var(--background-color);
      color: var(--text-color);
    }
    button[type="submit"] {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-color);
      padding: 0.5rem; /* Easier tap target */
      display: flex; /* Align icon nicely */
      align-items: center;
      justify-content: center;
    }
     button[type="submit"] .material-icons {
      font-family: var(--icon-font);
      font-size: clamp(1.4rem, 4vw, 1.6rem); /* Responsive icon size */
    }

    /* Stats Display Area */
    .stats-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem; /* Consistent spacing */
      margin-top: 1rem; /* Space below wallet section */
    }
    .stat-item {
        /* Aria-live will announce changes to screen readers */
        width: 100%; /* Ensure items take full width for alignment */
    }
    .total-paid {
      font-size: clamp(0.9rem, 2.8vw, 1.1rem);
      color: var(--secondary-text-color);
    }
    .pending {
      font-size: clamp(2rem, 7vw, 3.2rem);
      font-weight: 700;
      color: var(--primary-accent-color);
      line-height: 1.1; /* Adjust line height */
      word-break: break-all; /* Prevent long numbers from overflowing */
    }
    .metrics {
      font-size: clamp(1rem, 3.5vw, 1.3rem);
      color: var(--text-color);
    }
    .total-hashes {
      font-size: clamp(0.8rem, 2.5vw, 1rem);
      color: var(--secondary-text-color);
    }
    /* Loading/Error States */
    .loading-message, .error-message {
        font-size: clamp(1rem, 3vw, 1.2rem);
        color: var(--secondary-text-color);
        margin-top: 2rem;
    }
    .error-message {
        color: #d9534f; /* Reddish color for errors */
        font-weight: 500;
    }

    /* Fake Mining Hash Display */
    #mining-hash {
      position: fixed; /* Fixed at the bottom */
      bottom: 0.5rem;
      left: 0;
      width: 100%;
      text-align: center;
      font-family: monospace; /* Use monospace for hash */
      font-size: clamp(7px, 1.5vw, 9px);
      color: var(--secondary-text-color);
      opacity: 0.7;
      padding: 0 0.5rem; /* Add padding to prevent edge collision */
      word-break: break-all; /* Ensure hash wraps if needed */
      z-index: -1; /* Behind content if absolutely necessary, but fixed should work */
    }
  </style>
</head>
<body>
  <h1 class="visually-hidden">Dasbor Statistik Mining Monero (XMR)</h1> <!-- SEO: Main heading -->

  <div class="wallet-section">
    <button class="wallet-toggle" aria-label="Toggle Wallet Input" aria-expanded="false">
      <span class="material-icons" aria-hidden="true">expand_more</span>
    </button>
    <form id="walletForm">
      <input type="text" id="walletInput" placeholder="Masukkan Alamat Wallet XMR" required aria-label="Alamat Wallet XMR">
      <button type="submit" title="Simpan Wallet" aria-label="Simpan Alamat Wallet">
        <span class="material-icons" aria-hidden="true">save</span>
      </button>
    </form>
  </div>

  <main class="container">
    <div class="stats-info" id="statsInfo">
      <!-- Initial state / Loading message -->
      <div class="loading-message" id="loadingMessage">Masukkan alamat wallet XMR Anda...</div>
      <!-- Stats will be populated here by JS -->
      <div id="paid" class="total-paid stat-item" aria-live="polite">0.000000000000 XMR</div>
      <div id="pending" class="pending stat-item" aria-live="polite">0.000000000000 XMR</div>
      <div id="metrics" class="metrics stat-item" aria-live="polite">0 H/s - 0/0</div>
      <div id="hashes" class="total-hashes stat-item" aria-live="polite">0</div>
    </div>
  </main>

  <div id="mining-hash" aria-hidden="true">Initializing hash simulation...</div>

  <script>
    // --- Cookie Management ---
    function setCookie(name, value, days = 365) {
      const d = new Date();
      d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
      // Added SameSite=Lax and Secure (requires HTTPS) for better security
      const secureFlag = window.location.protocol === 'https:' ? '; Secure' : '';
      document.cookie = `${name}=${encodeURIComponent(value)};expires=${d.toUTCString()};path=/; SameSite=Lax${secureFlag}`;
    }

    function getCookie(name) {
      // More robust cookie parsing
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for(let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === ' ') c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
      }
      return '';
    }

    // --- DOM Elements ---
    const walletForm = document.getElementById('walletForm');
    const walletInput = document.getElementById('walletInput');
    const walletToggle = document.querySelector('.wallet-toggle');
    const statsInfoDiv = document.getElementById('statsInfo');
    const loadingMessageDiv = document.getElementById('loadingMessage');
    const paidEl = document.getElementById('paid');
    const pendingEl = document.getElementById('pending');
    const metricsEl = document.getElementById('metrics');
    const hashesEl = document.getElementById('hashes');
    const miningHashEl = document.getElementById('mining-hash');

    let currentWallet = getCookie('xmrWallet');
    let dashboardIntervalId = null;
    let isFetching = false; // Prevent multiple simultaneous fetches

    // --- UI Helper Functions ---
    function showLoading(message = "Memuat data...") {
        // Hide stats, show loading message
        paidEl.style.display = 'none';
        pendingEl.style.display = 'none';
        metricsEl.style.display = 'none';
        hashesEl.style.display = 'none';
        loadingMessageDiv.textContent = message;
        loadingMessageDiv.className = 'loading-message'; // Ensure correct class
        loadingMessageDiv.style.display = 'block';
    }

    function showError(message = "Gagal mengambil data. Coba lagi nanti.") {
        // Hide stats, show error message
        paidEl.style.display = 'none';
        pendingEl.style.display = 'none';
        metricsEl.style.display = 'none';
        hashesEl.style.display = 'none';
        loadingMessageDiv.textContent = message;
        loadingMessageDiv.className = 'error-message'; // Use error class for styling
        loadingMessageDiv.style.display = 'block';
        // Consider stopping the interval if error persists
        if (dashboardIntervalId) {
            clearInterval(dashboardIntervalId);
            dashboardIntervalId = null;
        }
    }

    function showStats() {
        // Show stats, hide loading/error message
        paidEl.style.display = 'block';
        pendingEl.style.display = 'block';
        metricsEl.style.display = 'block';
        hashesEl.style.display = 'block';
        loadingMessageDiv.style.display = 'none';
    }

    // --- Number Animation ---
    function animateNumber(element, targetValue, options = {}) {
        const {
            decimals = 12, // Default decimals
            duration = 1000, // Animation duration
            isAutoRefresh = false, // Flag for updates during interval
            suffix = "", // Suffix like " XMR"
            useCommas = false // Use locale string for commas
        } = options;

        const effectiveDuration = isAutoRefresh ? Math.max(duration, 1500) : duration; // Slower animation on auto-refresh
        let startValue = 0;
        const currentText = element.textContent.replace(suffix, '').replace(/,/g, '').trim();

        if (!isNaN(parseFloat(currentText))) {
             startValue = useCommas ? parseInt(currentText) || 0 : parseFloat(currentText) || 0;
        }

        // Avoid animation if value hasn't changed significantly
        if (Math.abs(targetValue - startValue) < (1 / Math.pow(10, decimals)) && decimals > 0) {
             // Update text directly if no significant change or just suffix/formatting needs update
             element.textContent = formatNumber(targetValue, decimals, useCommas) + suffix;
             return; // Exit if no real change
        }


        const range = targetValue - startValue;
        let startTime = null;

        function formatNumber(value, dec, commas) {
            if (commas) {
                // Handle potential non-integer values even with useCommas=true
                return Number(value.toFixed(0)).toLocaleString('en-US');
            } else if (dec > 0) {
                // Use 'en-US' locale for consistent decimal point formatting
                return value.toLocaleString('en-US', {
                    minimumFractionDigits: dec,
                    maximumFractionDigits: dec
                });
            } else {
                return Math.round(value).toString(); // Ensure integer for 0 decimals
            }
        }

        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / effectiveDuration, 1);
            const currentValue = startValue + range * progress;

            element.textContent = formatNumber(currentValue, decimals, useCommas) + suffix;

            if (progress < 1) {
                requestAnimationFrame(step);
            } else {
                 // Ensure final value is precise
                 element.textContent = formatNumber(targetValue, decimals, useCommas) + suffix;
            }
        }

        requestAnimationFrame(step);
    }


    // --- Data Fetching ---
    async function fetchData(isAutoRefresh = false) {
        if (!currentWallet || isFetching) {
            return; // Exit if no wallet or already fetching
        }

        isFetching = true;
        if (!isAutoRefresh) {
            showLoading(); // Show loading only on initial fetch or wallet change
        }

        try {
            const response = await fetch(`https://supportxmr.com/api/miner/${currentWallet}/stats`);
            if (!response.ok) {
                // Handle HTTP errors like 404 Not Found, 500 Internal Server Error
                let errorMsg = `Error: ${response.status} ${response.statusText}`;
                 if (response.status === 404) {
                     errorMsg = "Alamat Wallet tidak ditemukan di pool.";
                 }
                 // Try reading error message from API if available
                 try {
                     const errorData = await response.json();
                     if (errorData && errorData.error) {
                        errorMsg = `Error: ${errorData.error}`;
                     }
                 } catch (e) { /* Ignore if response body isn't JSON */ }

                throw new Error(errorMsg);
            }

            const data = await response.json();

            // Gracefully handle potential variations in API response structure
            const stats = data.stats || data || {}; // Use empty object as fallback

            const paidAmount = (stats.amtPaid || 0) / 1e12;
            const pendingAmount = (stats.amtDue || 0) / 1e12;
            const hashrate = parseFloat(stats.hashrate || stats.hash || 0); // Ensure number
            const validShares = parseInt(stats.validShares || 0);
            const invalidShares = parseInt(stats.invalidShares || 0);
            const totalHashes = parseInt(stats.totalHashes || 0);

            // Update DOM elements with animations
            showStats(); // Show stats elements before animating
            animateNumber(paidEl, paidAmount, { decimals: 12, suffix: " XMR", isAutoRefresh });
            animateNumber(pendingEl, pendingAmount, { decimals: 12, suffix: " XMR", isAutoRefresh });
            // For metrics, animate hashrate, update shares directly
            animateNumber(metricsEl, Math.round(hashrate), { decimals: 0, suffix: ` H/s - ${validShares.toLocaleString('en-US')}/${invalidShares.toLocaleString('en-US')}`, isAutoRefresh });
            // Animate total hashes with commas
            animateNumber(hashesEl, totalHashes, { decimals: 0, useCommas: true, isAutoRefresh });


        } catch (error) {
            console.error("Fetch error:", error);
            showError(error.message || "Gagal mengambil data."); // Show specific error if available
        } finally {
            isFetching = false; // Release fetch lock
        }
    }

    // --- Dashboard Initialization ---
    function initDashboard() {
        // Clear previous interval if exists
        if (dashboardIntervalId) {
            clearInterval(dashboardIntervalId);
        }

        if (!currentWallet) {
            showLoading("Masukkan alamat wallet XMR Anda..."); // Or hide stats area completely
            return;
        }

        fetchData(false); // Initial fetch (not auto-refresh)

        // Set interval for auto-refresh (e.g., every 30 seconds)
        // Increased interval to be less demanding on the API and user's device
        const refreshInterval = 30000; // 30 seconds
        dashboardIntervalId = setInterval(() => fetchData(true), refreshInterval);
    }

    // --- Fake Hash Animation ---
    function getRandomHex(length) {
      const hexChars = '0123456789abcdef';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += hexChars[Math.floor(Math.random() * hexChars.length)];
      }
      return result;
    }

    function updateFakeHash() {
      miningHashEl.textContent = getRandomHex(64); // Generate a 64-char hex string
    }

    // Start continuous fake hash update (every 1 second as requested)
    // Adjusted interval to 500ms for a slightly faster, more 'active' feel
    setInterval(updateFakeHash, 500); // Update every 500ms

    // --- Event Listeners ---
    walletForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const newWallet = walletInput.value.trim();
      if (newWallet && newWallet !== currentWallet) {
        currentWallet = newWallet;
        setCookie('xmrWallet', currentWallet); // Save the new wallet
        initDashboard(); // Re-initialize the dashboard with the new wallet

        // Close the form after submission
        walletForm.classList.remove('visible');
        walletToggle.classList.remove('open');
        walletToggle.setAttribute('aria-expanded', 'false');
        walletToggle.querySelector('.material-icons').textContent = 'expand_more';
      } else if (newWallet && newWallet === currentWallet) {
         // If same wallet submitted, just close the form
         walletForm.classList.remove('visible');
         walletToggle.classList.remove('open');
         walletToggle.setAttribute('aria-expanded', 'false');
         walletToggle.querySelector('.material-icons').textContent = 'expand_more';
      }
       // If input is empty, do nothing (or maybe show a small validation message)
    });

    walletToggle.addEventListener('click', () => {
      const isVisible = walletForm.classList.toggle('visible');
      walletToggle.classList.toggle('open');
      walletToggle.setAttribute('aria-expanded', isVisible.toString()); // Update aria-expanded
      const icon = walletToggle.querySelector('.material-icons');
      icon.textContent = isVisible ? 'expand_less' : 'expand_more';
      if (isVisible) {
          walletInput.focus(); // Focus input when opened
      }
    });

    // --- Initial Page Load Logic ---
    if (currentWallet) {
      walletInput.value = currentWallet; // Pre-fill input if cookie exists
      initDashboard(); // Start fetching data immediately
    } else {
      // No wallet saved, show the input form expanded by default
      walletForm.classList.add('visible');
      walletToggle.classList.add('open');
      walletToggle.setAttribute('aria-expanded', 'true');
      walletToggle.querySelector('.material-icons').textContent = 'expand_less';
      showLoading("Masukkan alamat wallet XMR untuk memulai."); // Initial prompt
    }

    // Initial hash display
    updateFakeHash();

  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>XMR Dashboard â€“ Vanilla CountUp</title>

  <!-- Google Font & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">

  <!-- CSS -->
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100%; width:100%; }
    body {
      font-family:'DM Sans', sans-serif;
      background:#fff;
      color:#000;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:1rem;
      position: relative;
    }
    .container {
      text-align:center;
      max-width:360px;
      width:100%;
      display:flex;
      flex-direction:column;
      justify-content:center;
      height:100%;
    }
    .wallet-toggle {
      background:#fff;
      border:1px solid #ddd;
      border-radius:50%;
      width:28px; height:28px;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.1);
      margin:0 auto 1rem;
      transition:transform .3s ease;
    }
    .wallet-toggle.open { transform: rotate(180deg); }
    .wallet-toggle .material-icons { font-size:18px; }

    form {
      display:flex; align-items:center; justify-content:center;
      gap:.5rem; width:100%; overflow:hidden;
      max-height:0; transition:max-height .3s ease-out;
    }
    form.visible { max-height:60px; padding:1rem 0; }
    input {
      flex:1; padding:.75rem;
      border:1px solid #ccc; border-radius:2rem;
      font-size:clamp(.9rem,2.5vw,1rem);
    }
    button {
      background:none; border:none; cursor:pointer;
      font-size:1.5rem; color:#000;
    }

    .info {
      display:flex; flex-direction:column;
      align-items:center; gap:1rem; margin:auto;
    }
    .total-paid {
      font-size:clamp(1rem,3vw,1.25rem); color:#333;
    }
    .pending {
      font-size:clamp(2rem,6vw,3rem); font-weight:700;
    }
    .metrics {
      font-size:clamp(1rem,3vw,1.25rem);
    }
    .total-hashes {
      font-size:clamp(.75rem,2vw,1rem); color:#888;
    }

    #mining-hash {
      position:absolute; bottom:1rem; width:100%;
      text-align:center;
      font-size:clamp(3pt,2vw,8pt); color:#888;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="wallet-toggle" id="walletToggle">
      <span class="material-icons">expand_more</span>
    </div>
    <form id="walletForm">
      <input type="text" id="walletInput" placeholder="Enter XMR Wallet Address" required>
      <button type="submit" title="Save Wallet">
        <span class="material-icons">save</span>
      </button>
    </form>

    <div class="info">
      <div id="paid" class="total-paid">0.000000000000</div>
      <div id="pending" class="pending">0.000000000000</div>
      <div id="metrics" class="metrics">
        <span id="hrNumber">0</span><span id="hrSuffix"> H/s - 0/0</span>
      </div>
      <div id="hashes" class="total-hashes">0</div>
    </div>
  </div>

  <div id="mining-hash"></div>

  <!-- CountUp.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.6.2/countUp.umd.js"></script>
  <script>
    // Cookie helpers
    function setCookie(name, value, days=365) {
      const d = new Date();
      d.setTime(d.getTime() + days*24*60*60*1000);
      document.cookie = name + "=" + encodeURIComponent(value) + ";expires=" + d.toUTCString() + ";path=/";
    }
    function getCookie(name) {
      return document.cookie.split('; ').reduce((r, v) => {
        const [k,val] = v.split('=');
        return k === name ? decodeURIComponent(val) : r;
      }, '');
    }

    // Elements
    const form = document.getElementById('walletForm');
    const input = document.getElementById('walletInput');
    const toggle = document.getElementById('walletToggle');
    let wallet = getCookie('xmrWallet');

    // Prefill & init UI
    if (wallet) input.value = wallet;
    else {
      form.classList.add('visible');
      toggle.classList.add('open');
    }

    // Toggle form
    toggle.addEventListener('click', () => {
      form.classList.toggle('visible');
      toggle.classList.toggle('open');
    });

    // Save wallet
    form.addEventListener('submit', e => {
      e.preventDefault();
      wallet = input.value.trim();
      if (!wallet) return;
      setCookie('xmrWallet', wallet);
      initDashboard();
    });

    // CountUp instances
    let paidCounter, pendingCounter, hrCounter;

    function updateCounters(paid, pendingVal, hr, vs, is) {
      if (!paidCounter) {
        paidCounter = new countUp.CountUp('paid', paid, {
          duration:1,
          decimalPlaces:12,
          useGrouping:false
        });
        pendingCounter = new countUp.CountUp('pending', pendingVal, {
          duration:1.2,
          decimalPlaces:12,
          useGrouping:false
        });
        hrCounter = new countUp.CountUp('hrNumber', hr, {
          duration:1,
          decimalPlaces:0,
          useGrouping:true
        });
        paidCounter.start();
        pendingCounter.start();
        hrCounter.start();
      } else {
        paidCounter.update(paid);
        pendingCounter.update(pendingVal);
        hrCounter.update(hr);
      }
      document.getElementById('hrSuffix').textContent = ` H/s - ${vs}/${is}`;
    }

    // Fetch data & update dashboard
    async function fetchData(isAuto=false) {
      if (!wallet) return;
      try {
        const res = await fetch(`https://supportxmr.com/api/miner/${wallet}/stats`);
        const data = await res.json();
        const base = data.stats||data;
        const paid = (base.amtPaid||0)/1e12;
        const pendingVal = (base.amtDue||0)/1e12;
        const hr = base.hashrate||base.hash||0;
        const vs = base.validShares||0;
        const is = base.invalidShares||0;
        const th = base.totalHashes||0;

        updateCounters(paid, pendingVal, Math.round(hr), vs, is);
        document.getElementById('hashes').textContent = th.toLocaleString();
      } catch(err) {
        console.error(err);
      }
    }

    function initDashboard() {
      fetchData();
      clearInterval(window.dashboardInterval);
      window.dashboardInterval = setInterval(() => fetchData(true), 2000);
    }

    if (wallet) initDashboard();

    // Fake mining hash generator
    function getRandomHex64() {
      const hex = '0123456789abcdef';
      let s=''; for (let i=0;i<64;i++) s += hex[Math.floor(Math.random()*16)];
      return s;
    }
    let hashCnt=0;
    const hi = setInterval(()=>{
      if (hashCnt>=50) return clearInterval(hi);
      document.getElementById('mining-hash').textContent = getRandomHex64();
      hashCnt++;
    }, 300);
  </script>
</body>
</html>
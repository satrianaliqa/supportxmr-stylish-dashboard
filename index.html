<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- SEO Optimization -->
  <title>Dasbor Statistik Mining Monero (XMR)</title>
  <meta name="description" content="Lacak statistik mining Monero (XMR) Anda secara real-time: saldo terutang (pending), total terbayar, hashrate, shares (valid/invalid), dan total hash. Dengan mode terang/gelap dan update animasi.">
  <meta name="keywords" content="monero, xmr, mining, stats, dashboard, cryptocurrency, hashrate, supportxmr, dark mode, light mode">
  <link rel="canonical" href="satrianaliqa.my.id" /> <!-- Ganti dengan URL halaman Anda jika sudah di-deploy -->
  
  <!-- Favicon -->
  <!-- <link rel="icon" href="/favicon.ico" sizes="any"> -->
  <!-- <link rel="icon" href="/favicon.svg" type="image/svg+xml"> -->
  <!-- <link rel="apple-touch-icon" href="/apple-touch-icon.png"> -->

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Outlined" rel="stylesheet"> <!-- Using Outlined icons -->

  <style>
    /* CSS Variables for Theming */
    :root {
      --background-color: #ffffff;
      --text-color: #000000;
      --primary-accent-color: #333333;
      --secondary-text-color: #666666;
      --border-color: #dddddd;
      --button-shadow-color: rgba(0, 0, 0, 0.1);
      --input-border-color: #cccccc;
      --header-bg-color: rgba(255, 255, 255, 0.85); /* Slightly transparent header */
      --hash-opacity: 0.6;
      --body-font: 'DM Sans', sans-serif;
      --icon-font: 'Material Icons Outlined'; /* Updated font family */
      --scroll-digit-bg: rgba(0, 0, 0, 0.03); /* BG for scrolling digits */
      --scroll-digit-color: var(--primary-accent-color);
    }

    body.dark-mode {
      --background-color: #1a1a1a;
      --text-color: #e0e0e0;
      --primary-accent-color: #f5f5f5;
      --secondary-text-color: #aaaaaa;
      --border-color: #444444;
      --button-shadow-color: rgba(255, 255, 255, 0.1);
      --input-border-color: #555555;
      --header-bg-color: rgba(26, 26, 26, 0.85);
      --hash-opacity: 0.5;
      --scroll-digit-bg: rgba(255, 255, 255, 0.08);
      --scroll-digit-color: var(--text-color);
    }

    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      width: 100%;
      overflow-x: hidden;
    }
    body {
      font-family: var(--body-font);
      background-color: var(--background-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      padding-top: 5rem; /* Add padding top to avoid overlap with fixed header */
      position: relative;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background-color 0.3s ease, color 0.3s ease; /* Theme transition */
    }

    /* Visually Hidden Class */
    .visually-hidden {
      position: absolute !important; height: 1px; width: 1px;
      overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap;
    }

    /* Header Section */
    .app-header {
      position: fixed; /* Fixed header */
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background-color: var(--header-bg-color);
      backdrop-filter: blur(5px); /* Frosted glass effect */
      -webkit-backdrop-filter: blur(5px);
      border-bottom: 1px solid var(--border-color);
      z-index: 100;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    .header-left, .header-right {
      display: flex;
      align-items: center;
      gap: 0.75rem; /* Spacing between buttons */
    }
    .icon-button {
      background: none;
      border: none;
      color: var(--text-color);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease, color 0.3s ease;
    }
    .icon-button:hover {
      background-color: rgba(0, 0, 0, 0.05); /* Subtle hover */
    }
    body.dark-mode .icon-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .icon-button .material-icons-outlined { /* Use the correct class */
      font-family: var(--icon-font);
      font-size: clamp(1.4rem, 4vw, 1.6rem);
      line-height: 1;
    }
    .back-button {
      text-decoration: none; /* Remove underline from link */
    }

    /* Wallet Input Section (Now triggered from header) */
    .wallet-form-container {
        position: fixed;
        top: 4rem; /* Below header */
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 400px;
        z-index: 90; /* Below header but above content */
        background-color: var(--background-color);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        transition: max-height 0.4s ease-out, opacity 0.3s ease-out, padding 0.4s ease-out, top 0.4s ease-out;
        padding: 0 1rem; /* Add horizontal padding */
        border-top: none; /* Avoid double border with header */
    }
    .wallet-form-container.visible {
        max-height: 100px;
        opacity: 1;
        padding: 1rem; /* Padding when visible */
        top: calc(3.5rem + 1px); /* Position below the header border */
    }
    body.dark-mode .wallet-form-container {
        box-shadow: 0 4px 15px rgba(255,255,255,0.05);
    }
    form#walletForm {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
    }
    input[type="text"]#walletInput {
      flex: 1;
      min-width: 0;
      padding: 0.75rem 1rem;
      border: 1px solid var(--input-border-color);
      border-radius: 2rem;
      font-size: clamp(0.85rem, 2.5vw, 1rem);
      font-family: var(--body-font);
      background-color: var(--background-color);
      color: var(--text-color);
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    /* Submit button styled like other icon buttons */
    button[type="submit"].icon-button {
      padding: 0.6rem; /* Slightly more padding for touch */
    }

    /* Main Content Container */
    .container {
      text-align: center;
      width: 100%;
      max-width: 360px;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      justify-content: center;
      padding-bottom: 3rem; /* Space for the fake hash */
      z-index: 1; /* Ensure content is above fake hash if needed */
    }
    /* Responsive adjustments */
    @media (min-width: 600px) { .container { max-width: 550px; } }
    @media (min-width: 900px) { .container { max-width: 750px; } }
    @media (min-width: 1200px) { .container { max-width: 850px; } }

    /* Stats Display Area */
    .stats-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.2rem; /* Slightly increased gap */
      margin-top: 1rem;
    }
    .stat-item {
        width: 100%;
        padding: 0.5rem; /* Add some padding */
        border-radius: 8px;
        background-color: var(--stat-item-bg);
        transition: background-color 0.3s ease;
    }
    .total-paid {
      font-size: clamp(0.9rem, 2.8vw, 1.1rem);
      color: var(--secondary-text-color);
      transition: color 0.3s ease;
    }
    .pending {
      font-size: clamp(2rem, 7vw, 3.2rem);
      font-weight: 700;
      color: var(--primary-accent-color);
      line-height: 1.1;
      word-break: break-all;
      transition: color 0.3s ease;
      /* Style for number 'scrolling' (applied by JS) */
      display: inline-block; /* Needed for digit wrapper */
    }
    .metrics {
      font-size: clamp(1rem, 3.5vw, 1.3rem);
      color: var(--text-color);
      transition: color 0.3s ease;
    }
    .total-hashes {
      font-size: clamp(0.8rem, 2.5vw, 1rem);
      color: var(--secondary-text-color);
      transition: color 0.3s ease;
    }
    /* Styling for the 'scrolling' number effect */
    .number-scroll-wrapper {
        display: inline-block; /* Or block depending on layout */
        position: relative;
        overflow: hidden; /* Hide the intermediate scrolling digits */
    }
    .digit-stream {
        display: inline-block;
        text-align: center;
        /* transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Example transition */
        /* More complex animation handled by JS */
    }
    /* Placeholder for actual digits during scroll */
    .digit-placeholder {
        /* background-color: var(--scroll-digit-bg); */
        color: var(--scroll-digit-color);
        display: inline-block;
        min-width: 0.6em; /* Adjust based on font */
        text-align: center;
    }


    /* Loading/Error States */
    .loading-message, .error-message {
        font-size: clamp(1rem, 3vw, 1.2rem);
        color: var(--secondary-text-color);
        margin-top: 2rem;
        transition: color 0.3s ease;
    }
    .error-message { color: #d9534f; font-weight: 500; }
    body.dark-mode .error-message { color: #ff7b7b; }

    /* Fake Mining Hash Display */
    #mining-hash {
      position: fixed;
      bottom: 0.5rem;
      left: 0;
      width: 100%;
      text-align: center;
      font-family: monospace;
      font-size: clamp(7px, 1.5vw, 9px);
      color: var(--secondary-text-color);
      opacity: var(--hash-opacity); /* Use variable */
      padding: 0 0.5rem;
      word-break: break-all;
      z-index: 0; /* Behind content */
      transition: opacity 0.3s ease, color 0.3s ease, text-shadow 0.2s ease-out; /* Added text-shadow transition */
      /* Diffusion effect: subtle shadow pulse on change */
      text-shadow: 0 0 3px transparent;
    }
    #mining-hash.hash-updating {
        opacity: 0.9; /* Slightly more visible during update */
        text-shadow: 0 0 5px var(--secondary-text-color); /* Subtle glow */
    }

  </style>
</head>
<body>
  <h1 class="visually-hidden">Dasbor Statistik Mining Monero (XMR)</h1>

  <header class="app-header">
    <div class="header-left">
      <a href="https://link.satrianaliqa.my.id" class="back-button icon-button" title="Kembali" aria-label="Kembali">
        <span class="material-icons-outlined" aria-hidden="true">arrow_back</span>
      </a>
    </div>
    <div class="header-right">
      <button class="icon-button" id="walletToggleBtn" aria-label="Toggle Input Wallet" aria-expanded="false" title="Input Wallet">
        <span class="material-icons-outlined" aria-hidden="true">account_balance_wallet</span>
      </button>
      <button class="icon-button" id="themeToggleBtn" aria-label="Toggle Dark Mode" title="Ganti Tema">
        <span class="material-icons-outlined" aria-hidden="true">light_mode</span> <!-- Default icon -->
      </button>
    </div>
  </header>

  <div class="wallet-form-container" id="walletFormContainer">
    <form id="walletForm">
      <input type="text" id="walletInput" placeholder="Masukkan Alamat Wallet XMR" required aria-label="Alamat Wallet XMR">
      <button type="submit" class="icon-button" title="Simpan Wallet" aria-label="Simpan Alamat Wallet">
        <span class="material-icons-outlined" aria-hidden="true">save</span>
      </button>
    </form>
  </div>

  <main class="container">
    <div class="stats-info" id="statsInfo">
      <!-- Initial state / Loading message -->
      <div class="loading-message" id="loadingMessage">Masukkan alamat wallet XMR Anda...</div>
      <!-- Stats will be populated here by JS -->
      <div class="stat-item" aria-live="polite"><span class="total-paid" id="paid">0.000000000000 XMR</span></div>
      <div class="stat-item" aria-live="polite"><span class="pending" id="pending">0.000000000000 XMR</span></div>
      <div class="stat-item" aria-live="polite"><span class="metrics" id="metrics">0 H/s - 0/0</span></div>
      <div class="stat-item" aria-live="polite"><span class="total-hashes" id="hashes">0</span></div>
    </div>
  </main>

  <div id="mining-hash" aria-hidden="true">Initializing hash simulation...</div>

  <script>
    // --- Cookie Management ---
    function setCookie(name, value, days = 365) {
      const d = new Date();
      d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
      const secureFlag = window.location.protocol === 'https:' ? '; Secure' : '';
      document.cookie = `${name}=${encodeURIComponent(value)};expires=${d.toUTCString()};path=/; SameSite=Lax${secureFlag}`;
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for(let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === ' ') c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
      }
      return '';
    }

    // --- DOM Elements ---
    const walletFormContainer = document.getElementById('walletFormContainer');
    const walletForm = document.getElementById('walletForm');
    const walletInput = document.getElementById('walletInput');
    const walletToggleBtn = document.getElementById('walletToggleBtn');
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const themeIcon = themeToggleBtn.querySelector('.material-icons-outlined');
    const statsInfoDiv = document.getElementById('statsInfo');
    const loadingMessageDiv = document.getElementById('loadingMessage');
    const paidEl = document.getElementById('paid');
    const pendingEl = document.getElementById('pending');
    const metricsEl = document.getElementById('metrics');
    const hashesEl = document.getElementById('hashes');
    const miningHashEl = document.getElementById('mining-hash');
    const body = document.body;

    let currentWallet = getCookie('xmrWallet');
    let dashboardIntervalId = null;
    let isFetching = false;
    let currentTheme = localStorage.getItem('theme') || 'light'; // Default to light

    // --- UI Helper Functions ---
    function showLoading(message = "Memuat data...") {
        statsInfoDiv.querySelectorAll('.stat-item').forEach(el => el.style.display = 'none');
        loadingMessageDiv.textContent = message;
        loadingMessageDiv.className = 'loading-message';
        loadingMessageDiv.style.display = 'block';
    }

    function showError(message = "Gagal mengambil data. Coba lagi nanti.") {
        statsInfoDiv.querySelectorAll('.stat-item').forEach(el => el.style.display = 'none');
        loadingMessageDiv.textContent = message;
        loadingMessageDiv.className = 'error-message';
        loadingMessageDiv.style.display = 'block';
        if (dashboardIntervalId) {
            clearInterval(dashboardIntervalId);
            dashboardIntervalId = null;
        }
    }

    function showStats() {
        statsInfoDiv.querySelectorAll('.stat-item').forEach(el => el.style.display = 'block');
        loadingMessageDiv.style.display = 'none';
    }

    // --- Theme Management ---
    function applyTheme(theme) {
        if (theme === 'dark') {
            body.classList.add('dark-mode');
            themeIcon.textContent = 'dark_mode'; // Moon icon
            themeToggleBtn.setAttribute('aria-label', 'Toggle Light Mode');
        } else {
            body.classList.remove('dark-mode');
            themeIcon.textContent = 'light_mode'; // Sun icon
            themeToggleBtn.setAttribute('aria-label', 'Toggle Dark Mode');
        }
        localStorage.setItem('theme', theme);
        currentTheme = theme;
    }

    themeToggleBtn.addEventListener('click', () => {
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
    });

    // Apply initial theme
    applyTheme(currentTheme);

    // --- Enhanced Number Animation (Odometer-like effect) ---
    function animateNumberEnhanced(element, targetValue, options = {}) {
        const {
            decimals = 0,
            duration = 800, // Slightly shorter duration for effect
            isAutoRefresh = false,
            suffix = "",
            useCommas = false
        } = options;

        // Use a faster, snappier duration for auto-refreshes
        const effectiveDuration = isAutoRefresh ? 500 : duration;
        const frameRate = 30; // Update frequency (ms)
        const totalFrames = Math.round(effectiveDuration / frameRate);
        let currentFrame = 0;

        // Get current value (more robust parsing)
        let startValue = 0;
        const currentText = element.textContent.replace(suffix, '').replace(/,/g, '').trim();
        if (!isNaN(parseFloat(currentText))) {
            startValue = useCommas ? parseInt(currentText) || 0 : parseFloat(currentText) || 0;
        }

        const range = targetValue - startValue;

        // Avoid animation if no significant change
        if (Math.abs(range) < (1 / Math.pow(10, decimals)) && decimals > 0) {
             element.textContent = formatNumber(targetValue, decimals, useCommas) + suffix;
             return;
        }
        if (range === 0 && decimals === 0) {
             element.textContent = formatNumber(targetValue, decimals, useCommas) + suffix;
             return;
        }

        // Clear existing interval if any for this element
        if (element.animationInterval) {
            clearInterval(element.animationInterval);
        }

        function formatNumber(value, dec, commas) {
             if (commas) {
                 return Number(value.toFixed(0)).toLocaleString('en-US');
             } else if (dec > 0) {
                 return value.toLocaleString('en-US', {
                     minimumFractionDigits: dec,
                     maximumFractionDigits: dec
                 });
             } else {
                 return Math.round(value).toString();
             }
         }

         function easeOutQuad(t) { return t * (2 - t); } // Easing function

         element.animationInterval = setInterval(() => {
            currentFrame++;
            const progress = easeOutQuad(currentFrame / totalFrames);
            let currentValue = startValue + range * progress;

            // --- "Scrolling" effect simulation ---
            // For the first part of the animation, show rapidly changing numbers
            // This is a basic simulation, not true digit scrolling.
            let displayValue = currentValue;
            if (currentFrame < totalFrames * 0.7) { // e.g., for the first 70%
                 const randomFactor = (Math.random() - 0.5) * range * 0.2; // Smaller random jitter
                 const jitterValue = currentValue + randomFactor;
                 // Ensure random value doesn't drastically differ in magnitude for large numbers
                 displayValue = Math.max(0, jitterValue); // Prevent negative if target is positive
                 if (decimals === 0) displayValue = Math.round(displayValue);
            } else {
                 // Settle towards the target in the last part
                 displayValue = currentValue;
            }

             element.textContent = formatNumber(displayValue, decimals, useCommas) + suffix;

            if (currentFrame >= totalFrames) {
                clearInterval(element.animationInterval);
                element.animationInterval = null;
                element.textContent = formatNumber(targetValue, decimals, useCommas) + suffix; // Ensure final value is exact
            }
        }, frameRate);
    }


    // --- Data Fetching (using new animation function) ---
    async function fetchData(isAutoRefresh = false) {
        if (!currentWallet || isFetching) return;
        isFetching = true;
        if (!isAutoRefresh) showLoading();

        try {
            // Added cache busting parameter to potentially avoid stale data
            const cacheBuster = new Date().getTime();
            const response = await fetch(`https://supportxmr.com/api/miner/${currentWallet}/stats?_=${cacheBuster}`);
            if (!response.ok) {
                 let errorMsg = `Error: ${response.status} ${response.statusText}`;
                 if (response.status === 404) errorMsg = "Alamat Wallet tidak ditemukan.";
                 try { const errorData = await response.json(); if (errorData && errorData.error) errorMsg = `Error: ${errorData.error}`; } catch (e) {}
                throw new Error(errorMsg);
            }

            const data = await response.json();
            const stats = data.stats || data || {};

            const paidAmount = (stats.amtPaid || 0) / 1e12;
            const pendingAmount = (stats.amtDue || 0) / 1e12;
            const hashrate = parseFloat(stats.hashrate || stats.hash || 0);
            const validShares = parseInt(stats.validShares || 0);
            const invalidShares = parseInt(stats.invalidShares || 0);
            const totalHashes = parseInt(stats.totalHashes || 0);

            showStats(); // Show elements before animating

            // Use the enhanced animation function
            animateNumberEnhanced(paidEl, paidAmount, { decimals: 12, suffix: " XMR", isAutoRefresh });
            animateNumberEnhanced(pendingEl, pendingAmount, { decimals: 12, suffix: " XMR", isAutoRefresh });
            // For metrics, animate hashrate, but keep shares simple update
            animateNumberEnhanced(metricsEl, Math.round(hashrate), {
                decimals: 0,
                suffix: ` H/s - ${validShares.toLocaleString('en-US')}/${invalidShares.toLocaleString('en-US')}`, // Update shares within suffix
                isAutoRefresh
            });
            animateNumberEnhanced(hashesEl, totalHashes, { decimals: 0, useCommas: true, isAutoRefresh });

        } catch (error) {
            console.error("Fetch error:", error);
            showError(error.message || "Gagal mengambil data.");
        } finally {
            isFetching = false;
        }
    }

    // --- Dashboard Initialization ---
    function initDashboard() {
        if (dashboardIntervalId) clearInterval(dashboardIntervalId);
        if (!currentWallet) {
            showLoading("Masukkan alamat wallet XMR Anda...");
            return;
        }
        fetchData(false); // Initial fetch
        const refreshInterval = 30000; // 30 seconds
        dashboardIntervalId = setInterval(() => fetchData(true), refreshInterval);
    }

    // --- Fake Hash Animation (with "Diffusion" effect) ---
    function getRandomHex(length) {
      const hexChars = '0123456789abcdef';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += hexChars[Math.floor(Math.random() * hexChars.length)];
      }
      return result;
    }

    let hashUpdateTimeout = null;
    function updateFakeHash() {
        // Apply updating class for visual effect (glow/shadow)
        miningHashEl.classList.add('hash-updating');

        // Change the text content
        miningHashEl.textContent = getRandomHex(64);

        // Clear previous timeout if exists
        if (hashUpdateTimeout) clearTimeout(hashUpdateTimeout);

        // Remove the updating class shortly after to fade the effect out
        hashUpdateTimeout = setTimeout(() => {
            miningHashEl.classList.remove('hash-updating');
        }, 250); // Duration of the glow effect (ms)
    }

    // Start continuous fake hash update (every 500ms)
    setInterval(updateFakeHash, 500);

    // --- Event Listeners ---
    walletForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const newWallet = walletInput.value.trim();
      if (newWallet) { // Only proceed if input is not empty
        if (newWallet !== currentWallet) {
            currentWallet = newWallet;
            setCookie('xmrWallet', currentWallet);
            initDashboard(); // Re-initialize with new wallet
        }
        // Close the form regardless of whether wallet changed or not
        walletFormContainer.classList.remove('visible');
        walletToggleBtn.setAttribute('aria-expanded', 'false');
      }
    });

    walletToggleBtn.addEventListener('click', () => {
      const isVisible = walletFormContainer.classList.toggle('visible');
      walletToggleBtn.setAttribute('aria-expanded', isVisible.toString());
      if (isVisible) {
          // Delay focus slightly to allow transition to complete
          setTimeout(() => walletInput.focus(), 100);
      }
    });

    // Close wallet input if clicking outside of it
    document.addEventListener('click', (event) => {
        if (!walletFormContainer.contains(event.target) && !walletToggleBtn.contains(event.target) && walletFormContainer.classList.contains('visible')) {
            walletFormContainer.classList.remove('visible');
            walletToggleBtn.setAttribute('aria-expanded', 'false');
        }
    });


    // --- Initial Page Load Logic ---
    if (currentWallet) {
      walletInput.value = currentWallet;
      initDashboard();
    } else {
      showLoading("Masukkan alamat wallet XMR untuk memulai.");
      // Optionally open the wallet input form automatically if no wallet is set
      // walletFormContainer.classList.add('visible');
      // walletToggleBtn.setAttribute('aria-expanded', 'true');
      // setTimeout(() => walletInput.focus(), 100);
    }

    // Initial hash display
    updateFakeHash();

  </script>
</body>
</html>
